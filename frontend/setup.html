<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VulnPilot AI - Agentic Vulnerability Management</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;0,9..40,900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f0fdfa;--bg2:#e6f7f3;--card:#ffffff;--border:#d1d5db;--text:#1e293b;--text-heading:#0f172a;--muted:#64748b;--dim:#94a3b8;--blue:#1e40af;--blue-light:#3b82f6;--green:#16a34a;--red:#ef4444;--yellow:#eab308;--purple:#7c3aed;--cyan:#0f766e;--orange:#ea580c;--orange-light:#f97316;--orange-pale:#fff7ed;--orange-border:#fed7aa;--blue-pale:#eff6ff;--blue-border:#bfdbfe;--teal-pale:#f0fdfa;--teal-border:#99f6e4;--green-pale:#f0fdf4;--green-border:#bbf7d0;--red-pale:#fef2f2;--red-border:#fecaca;--amber-pale:#fffbeb;--amber-border:#fde68a;--purple-pale:#f5f3ff;--purple-border:#ddd6fe;--radius-card:14px;--radius-callout:10px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:#f0fdfa;color:var(--text);min-height:100vh;padding:28px;font-size:15px;-webkit-font-smoothing:antialiased}
a{color:var(--blue-light);text-decoration:none}a:hover{text-decoration:underline}
.hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.hdr h1{font-size:26px;font-weight:800;color:#0f172a}
.tabs{display:flex;gap:8px;margin-bottom:24px}
.tab{padding:10px 24px;border-radius:var(--radius-callout);font-size:15px;font-weight:600;cursor:pointer;border:1px solid var(--border);background:var(--card);color:var(--muted);transition:all .2s}
.tab.active{background:var(--orange);color:#fff;border-color:var(--orange)}
.tab:hover:not(.active){background:#ebedf0;border-color:#94a3b8}
.panel{display:none}.panel.active{display:block}
.drift-preset{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-callout);padding:14px 16px;cursor:pointer;transition:all .2s;text-align:left;color:var(--text);font-family:inherit}
.drift-preset:hover{border-color:var(--orange);background:#f8f9fc}
.drift-preset.active{border-color:var(--orange-border);background:var(--orange-pale)}
.drift-slider-row{display:flex;align-items:center;gap:16px;margin-bottom:16px;padding:12px 16px;background:#ffffff;border:1px solid var(--border);border-radius:var(--radius-callout)}
.drift-tier-label{display:flex;align-items:center;gap:10px;min-width:260px}
.drift-slider-wrap{flex:1;display:flex;align-items:center;gap:12px}
.drift-slider{-webkit-appearance:none;flex:1;height:6px;border-radius:3px;background:#d1d5db;outline:none}
.drift-slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:linear-gradient(135deg,var(--orange-light),var(--orange));cursor:pointer;box-shadow:0 2px 8px rgba(234,88,12,.25)}
.drift-slider::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:linear-gradient(135deg,var(--orange-light),var(--orange));cursor:pointer;border:none}
.drift-val{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;color:var(--orange);min-width:40px;text-align:right}
@media(max-width:700px){.drift-slider-row{flex-direction:column;gap:8px}.drift-tier-label{min-width:auto}}
.qp-box{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-card);padding:24px;margin-bottom:24px;box-shadow:0 1px 3px rgba(15,23,42,0.04)}
.qp-box h3{font-size:16px;margin-bottom:12px;color:#0f172a}
.qp-grid{display:flex;flex-direction:column;gap:16px}
.qp-section{background:#ffffff;border:1px solid var(--border);border-radius:var(--radius-card);padding:20px;transition:all .3s}
.qp-section:hover{border-color:var(--orange-border);box-shadow:0 2px 12px rgba(234,88,12,0.06)}
.qp-section-title{font-size:14px;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:1px;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.qp-section-title::before{content:'';display:inline-block;width:3px;height:16px;background:var(--orange);border-radius:2px}
.qp-fields{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.qp-field{display:flex;flex-direction:column;gap:4px}
.qp-field label{font-size:12px;color:var(--orange);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.qp-field input{background:#ffffff;border:1px solid var(--border);border-radius:6px;padding:10px 14px;color:#0f172a;font-family:'JetBrains Mono',monospace;font-size:13px;transition:all .2s}
.qp-field input:focus{outline:none;border-color:var(--blue-light);box-shadow:0 0 8px rgba(59,130,246,0.12)}
.qp-field input:hover{border-color:var(--orange)}
.qp-field input.done{border-color:var(--green)}
.qp-hint{font-size:10px;color:#94a3b8}
.qp-cat{display:none}
.cat{margin-bottom:28px}
.cat-title{font-size:14px;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:12px}
.ic{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-card);padding:16px;transition:border-color .2s;box-shadow:0 1px 3px rgba(15,23,42,0.04)}
.ic:hover{border-color:var(--orange)}.ic.on{border-color:var(--green)}.ic.on .dot{background:var(--green)}
.ic.pending{border-color:var(--yellow)}.ic.pending .dot{background:var(--yellow)}
.ic-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.ic-name{font-size:16px;font-weight:700;color:#0f172a}
.ic-file{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--dim);margin-top:1px}
.badge{font-size:10px;font-weight:600;padding:3px 9px;border-radius:12px;white-space:nowrap}
.b-free{background:var(--green-pale);color:var(--green)}.b-lab{background:var(--blue-pale);color:var(--blue)}
.b-tier{background:var(--purple-pale);color:var(--purple)}.b-oss{background:var(--teal-pale);color:var(--cyan)}.b-dev{background:var(--amber-pale);color:#b45309}
.ic-desc{font-size:13px;color:var(--muted);margin-bottom:8px;line-height:1.4}
.ic-status{display:flex;align-items:center;gap:6px;margin-bottom:8px}
.dot{width:7px;height:7px;border-radius:50%;background:var(--dim)}
.stxt{font-size:11px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.auto-tag{font-size:9px;font-weight:700;color:var(--green);background:var(--green-pale);padding:2px 7px;border-radius:8px;margin-left:5px}
.ic-fields{display:none;margin:8px 0}.ic.expanded .ic-fields{display:block}
.fd{margin-bottom:6px}
.fd label{display:block;font-size:10px;color:var(--dim);margin-bottom:2px;text-transform:uppercase;letter-spacing:.5px}
.fd input{width:100%;background:#ffffff;border:1px solid var(--border);border-radius:5px;padding:7px 10px;color:#0f172a;font-family:'JetBrains Mono',monospace;font-size:12px}
.fd input:focus{outline:none;border-color:var(--blue-light)}.fd .ht{font-size:10px;color:var(--dim);margin-top:2px}
.docker-cmd{margin:6px 0;padding:6px 10px;background:#e6f7f3;border:1px solid var(--border);border-radius:5px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--cyan);word-break:break-all;cursor:pointer}
.ic-btns{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.btn{padding:6px 12px;border-radius:5px;border:none;font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-en{background:var(--green);color:#fff}.btn-su{background:transparent;border:1px solid var(--blue-light);color:var(--blue-light)}
.btn-te{background:transparent;border:1px solid var(--border);color:var(--muted)}.btn-ex{background:transparent;border:1px solid var(--border);color:var(--muted)}
.bar{position:fixed;bottom:0;left:0;right:0;background:#ebedf0;border-top:1px solid var(--border);padding:12px 24px;display:flex;justify-content:space-between;align-items:center;z-index:100;box-shadow:0 -2px 12px rgba(15,23,42,0.06)}
.bar .st{color:var(--muted);font-size:14px}
.bar-btns{display:flex;gap:10px}
.btn-save{background:var(--orange);color:#fff;padding:11px 26px;font-size:14px;border-radius:7px;border:none;font-weight:700;cursor:pointer;transition:all .2s}
.btn-save:hover{background:var(--orange-light)}
.btn-restart{background:var(--green);color:#fff;padding:9px 22px;font-size:13px;border-radius:7px;border:none;font-weight:700;cursor:pointer;display:none;transition:all .2s}
.mb-60{margin-bottom:60px}
.count-badge{background:var(--orange);color:#fff;font-size:11px;font-weight:700;padding:2px 8px;border-radius:10px;margin-left:8px}
.docs-cat{margin-bottom:28px}.docs-cat-hdr{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding-bottom:8px;border-bottom:2px solid var(--border)}
.docs-cat-title{font-size:15px;font-weight:700;color:var(--text-heading)}.docs-cat-count{font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace}
.acc{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-card);margin-bottom:8px;overflow:hidden;transition:border-color .2s}
.acc:hover{border-color:var(--orange-border)}.acc.connected{border-left:3px solid var(--green)}
.acc-hdr{padding:14px 18px;cursor:pointer;display:flex;align-items:center;gap:12px;user-select:none;transition:background .15s}.acc-hdr:hover{background:#fafbfc}
.acc-info{flex:1;min-width:0}.acc-name{font-size:15px;font-weight:700;color:var(--text-heading)}.acc-sub{font-size:12px;color:var(--muted);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.acc-badges{display:flex;gap:5px;flex-shrink:0}.acc-arrow{font-size:14px;color:var(--dim);transition:transform .2s;flex-shrink:0}.acc.open .acc-arrow{transform:rotate(180deg)}
.acc-body{display:none;padding:0 18px 18px;border-top:1px solid var(--border)}.acc.open .acc-body{display:block}
.step{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid #f1f5f9}.step:last-child{border-bottom:none}
.step-n{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--orange-light),var(--orange));color:#fff;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.step-c{flex:1;font-size:13px;color:var(--text);line-height:1.6}.step-c strong{color:var(--text-heading)}.step-c code{background:#f0fdfa;border:1px solid var(--border);padding:1px 6px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--cyan)}
.doc-env{margin:8px 0;padding:8px 12px;background:#0f172a;border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:11px;color:#94a3b8;line-height:1.8;overflow-x:auto;cursor:pointer;position:relative}.doc-env:hover::after{content:'üìã Click to copy';position:absolute;top:6px;right:8px;font-size:9px;color:var(--orange);font-family:'DM Sans',sans-serif}.doc-env .v{color:#4ade80}.doc-env .c{color:#475569}
.doc-spec{margin-top:10px;padding:12px;background:var(--orange-pale);border:1px solid var(--orange-border);border-radius:8px}.doc-spec-title{font-size:11px;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.doc-spec-row{display:flex;justify-content:space-between;padding:3px 0;font-size:12px;border-bottom:1px solid rgba(234,88,12,.1)}.doc-spec-row:last-child{border:none}.doc-spec-k{color:var(--muted);font-weight:600}.doc-spec-v{color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px}
.doc-warn{margin:10px 0;padding:10px 14px;background:var(--amber-pale);border:1px solid var(--amber-border);border-radius:8px;font-size:12px;color:#92400e;line-height:1.5}
.doc-ok{margin:10px 0;padding:10px 14px;background:var(--green-pale);border:1px solid var(--green-border);border-radius:8px;font-size:12px;color:#166534}
.doc-test-btn{display:inline-flex;align-items:center;gap:6px;margin-top:8px;padding:8px 18px;border-radius:8px;border:1px solid var(--orange);background:var(--orange-pale);color:var(--orange);font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s}.doc-test-btn:hover{background:var(--orange);color:#fff}
.docs-search{width:100%;padding:12px 18px;border:1px solid var(--border);border-radius:10px;font-size:15px;font-family:'DM Sans',sans-serif;background:var(--card);color:var(--text);margin-bottom:20px;transition:border-color .2s}.docs-search:focus{outline:none;border-color:var(--orange);box-shadow:0 0 12px rgba(234,88,12,.1)}
</style>
</head>
<body>
<div class="hdr">
  <div style="cursor:pointer" onclick="window.location='/'">
    <h1 style="display:flex;align-items:center;gap:14px">
      <svg width="56" height="56" viewBox="140 135 40 35" xmlns="http://www.w3.org/2000/svg"><path d="M157,160c0-0.266-0.046-0.519-0.11-0.764l4.715-2.144C162.31,158.233,163.562,159,165,159c0.466,0,0.905-0.095,1.32-0.241 l1.913,3.827c-0.744,0.546-1.233,1.42-1.233,2.414c0,1.657,1.343,3,3,3s3-1.343,3-3s-1.343-3-3-3 c-0.305,0-0.593,0.059-0.869,0.143l-1.909-3.818c0.822-0.55,1.419-1.4,1.657-2.391l3.149,0.35c0.14,0.969,0.965,1.716,1.972,1.716 c1.104,0,2-0.896,2-2s-0.896-2-2-2c-0.854,0-1.577,0.537-1.864,1.29l-3.142-0.349c-0.02-1.31-0.67-2.461-1.659-3.176l2.693-4.939 c0.307,0.105,0.63,0.175,0.972,0.175c1.657,0,3-1.343,3-3s-1.343-3-3-3s-3,1.343-3,3c0,0.955,0.455,1.796,1.151,2.346 l-2.693,4.938C166.005,151.105,165.516,151,165,151c-0.924,0-1.764,0.326-2.44,0.852l-3.842-3.842 c0.175-0.297,0.282-0.64,0.282-1.01c0-1.104-0.896-2-2-2s-2,0.896-2,2s0.896,2,2,2c0.37,0,0.713-0.107,1.011-0.283l3.842,3.842 C161.326,153.236,161,154.076,161,155c0,0.414,0.081,0.804,0.197,1.179l-4.712,2.142C155.946,157.524,155.034,157,154,157 c-1.657,0-3,1.343-3,3s1.343,3,3,3S157,161.657,157,160z M170,163c1.103,0,2,0.897,2,2s-0.897,2-2,2s-2-0.897-2-2 S168.897,163,170,163z M169,144c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2S169,145.103,169,144z M174,155c0.552,0,1,0.449,1,1 s-0.448,1-1,1s-1-0.449-1-1S173.448,155,174,155z M157,148c-0.552,0-1-0.449-1-1s0.448-1,1-1s1,0.449,1,1S157.552,148,157,148z M162,155c0-1.657,1.343-3,3-3s3,1.343,3,3s-1.343,3-3,3S162,156.657,162,155z M152,160c0-1.103,0.897-2,2-2s2,0.897,2,2 s-0.897,2-2,2S152,161.103,152,160z" fill="#ea580c"/></svg>
      <span style="font-weight:800;color:#0f172a;font-size:28px">Vuln<span style="color:#ea580c">Pilot</span> AI - Agentic Vulnerability Management</span></h1>
    <div style="color:var(--muted);font-size:12px;margin-top:2px;letter-spacing:2px;text-transform:uppercase">Zero Noise ¬∑ Zero Delay ¬∑ Zero Missed Patches</div>
  </div>
  <a href="/" style="color:var(--orange);font-weight:600">‚Üê Dashboard</a>
</div>
<div class="tabs">
  <div class="tab active" id="tab-quick" onclick="showTab('quick')">‚ö° Quick Paste<span class="count-badge" id="qpCount">0</span></div>
  <div class="tab" id="tab-visual" onclick="showTab('visual')">üéõÔ∏è Visual Setup</div>
  <div class="tab" id="tab-drift" onclick="showTab('drift')">üîÑ Drift Detector</div>
  <div class="tab" id="tab-docs" onclick="showTab('docs')">üìñ Docs &amp; Integrations<span class="count-badge">31</span></div>
</div>
<div class="panel active" id="panel-quick">
  <div class="qp-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <div>
        <h3 style="margin-bottom:4px">Already have your API keys? Paste them all here - one page, done.</h3>
        <p style="color:var(--muted);font-size:13px;margin:0">Fill in only what you have. Leave the rest blank. VulnPilot auto-detects which integrations to enable based on what you provide.</p>
      </div>
      <div style="text-align:center;padding:8px 16px;background:var(--orange-pale);border:1px solid var(--orange-border);border-radius:10px;white-space:nowrap">
        <div style="font-size:24px;font-weight:900;color:var(--orange)">27</div>
        <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Integrations</div>
      </div>
    </div>
    <div class="qp-grid" id="qpGrid"></div>
  </div>
</div>
<div class="panel" id="panel-visual"><div id="visualContent" class="mb-60"></div></div>
<div class="panel" id="panel-drift">
  <div class="qp-box" id="driftConfig">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <h3 id="drift">üîÑ Drift Detector - Lock 3 Configuration</h3>
      <div style="display:flex;gap:8px">
        <button onclick="resetDriftDefaults()" style="padding:6px 14px;border-radius:6px;border:1px solid var(--orange);background:var(--orange-pale);color:var(--orange);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s" onmouseover="this.style.background='var(--orange-border)'" onmouseout="this.style.background='var(--orange-pale)'">‚Ü∫ RESET DEFAULT</button>
        <button id="driftLockBtn" onclick="toggleDriftLock()" style="padding:6px 14px;border-radius:6px;border:1px solid var(--orange-light);background:var(--orange-pale);color:var(--orange-light);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s" onmouseover="this.style.background='var(--orange-border)'" onmouseout="this.style.background='var(--orange-pale)'">üîì UNLOCKED</button>
      </div>
    </div>
    <p style="color:var(--muted);font-size:13px;margin-bottom:20px">
      The Drift Detector rechecks deprioritized CVEs against live threat intel (EPSS, KEV, dark web).
      Tiered intervals let you check crown jewels more frequently while saving API quota on standard assets.
    </p>

    <!-- ONE-CLICK PRESETS -->
    <div style="margin-bottom:24px">
      <div style="font-size:12px;font-weight:700;color:#0f172a;letter-spacing:1px;text-transform:uppercase;margin-bottom:12px">‚ö° One-Click Presets</div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px" id="driftPresets">
        <button class="drift-preset" onclick="applyDriftPreset(1,1,1)" data-name="realtime">
          <div style="font-weight:700;font-size:14px;color:#EF4444">üî¥ Real-Time</div>
          <div style="font-size:11px;color:var(--muted)">All tiers: 1h - Maximum protection, highest API cost</div>
        </button>
        <button class="drift-preset active" onclick="applyDriftPreset(1,2,4)" data-name="aggressive">
          <div style="font-weight:700;font-size:14px;color:#F07A2F">üü† Aggressive</div>
          <div style="font-size:11px;color:var(--muted)">T1: 1h, T2: 2h, T3: 4h - High protection, moderate cost</div>
        </button>
        <button class="drift-preset" onclick="applyDriftPreset(1,3,6)" data-name="balanced">
          <div style="font-weight:700;font-size:14px;color:#22C55E">üü¢ Balanced</div>
          <div style="font-size:11px;color:var(--muted)">T1: 1h, T2: 3h, T3: 6h - Recommended for most teams</div>
        </button>
        <button class="drift-preset" onclick="applyDriftPreset(2,6,12)" data-name="conservative">
          <div style="font-weight:700;font-size:14px;color:#3B82F6">üîµ Conservative</div>
          <div style="font-size:11px;color:var(--muted)">T1: 2h, T2: 6h, T3: 12h - Low cost, slower detection</div>
        </button>
      </div>
    </div>

    <!-- CUSTOM SLIDERS -->
    <div style="margin-bottom:24px">
      <div style="font-size:12px;font-weight:700;color:#0f172a;letter-spacing:1px;text-transform:uppercase;margin-bottom:16px">üéõÔ∏è Custom Intervals (or adjust sliders below)</div>

      <div class="drift-slider-row">
        <div class="drift-tier-label">
          <span style="color:#EF4444;font-size:16px">üèõÔ∏è</span>
          <div><div style="font-weight:700;color:#0f172a">Tier 1 - Crown Jewels</div>
          <div style="font-size:11px;color:var(--muted)">Payment systems, domain controllers, firewalls</div></div>
        </div>
        <div class="drift-slider-wrap">
          <input type="range" min="1" max="12" value="1" id="driftT1" class="drift-slider" oninput="updateDriftDisplay()">
          <div class="drift-val" id="driftT1Val">1h</div>
        </div>
      </div>

      <div class="drift-slider-row">
        <div class="drift-tier-label">
          <span style="color:#F07A2F;font-size:16px">‚ö°</span>
          <div><div style="font-weight:700;color:#0f172a">Tier 2 - Important Assets</div>
          <div style="font-size:11px;color:var(--muted)">Web servers, databases, CI/CD pipelines</div></div>
        </div>
        <div class="drift-slider-wrap">
          <input type="range" min="1" max="12" value="3" id="driftT2" class="drift-slider" oninput="updateDriftDisplay()">
          <div class="drift-val" id="driftT2Val">3h</div>
        </div>
      </div>

      <div class="drift-slider-row">
        <div class="drift-tier-label">
          <span style="color:#3B82F6;font-size:16px">üì¶</span>
          <div><div style="font-weight:700;color:#0f172a">Tier 3 - Standard Assets</div>
          <div style="font-size:11px;color:var(--muted)">Workstations, printers, lab systems</div></div>
        </div>
        <div class="drift-slider-wrap">
          <input type="range" min="1" max="24" value="6" id="driftT3" class="drift-slider" oninput="updateDriftDisplay()">
          <div class="drift-val" id="driftT3Val">6h</div>
        </div>
      </div>
    </div>

    <!-- IMPACT PREVIEW -->
    <div style="background:var(--orange-pale);border:1px solid var(--orange-border);border-radius:var(--radius-card);padding:16px;margin-bottom:20px" id="driftImpact">
      <div style="font-size:12px;font-weight:700;color:var(--orange);margin-bottom:8px">üìä Impact Preview</div>
      <div style="font-size:13px;color:var(--text)" id="driftImpactText">Loading...</div>
    </div>

    <!-- SAVE BUTTON -->
    <button class="btn-save" onclick="saveDriftConfig()" style="width:100%;padding:14px;font-size:15px;border-radius:12px" id="driftSaveBtn">üíæ Save Drift Configuration</button>
    <div id="driftSaveStatus" style="text-align:center;font-size:12px;color:var(--muted);margin-top:8px"></div>
  </div>
</div>
<!-- ‚ïê‚ïê‚ïê DOCS & INTEGRATIONS PANEL ‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-docs">
<div class="qp-box">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
    <div>
      <h3 style="margin-bottom:4px">üìñ Integration Guides ‚Äî Step-by-Step for All 27</h3>
      <p style="color:var(--muted);font-size:13px;margin:0">Click any integration to expand setup instructions, API specs, and test connection.</p>
    </div>
    <div style="display:flex;gap:6px"><button onclick="expandAllDocs()" style="padding:5px 12px;border:1px solid var(--border);border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;background:var(--card);color:var(--muted);font-family:inherit">‚ñº Expand All</button><button onclick="collapseAllDocs()" style="padding:5px 12px;border:1px solid var(--border);border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;background:var(--card);color:var(--muted);font-family:inherit">‚ñ≤ Collapse All</button></div>
  </div>
  <input type="text" class="docs-search" placeholder="üîç Search integrations... (e.g. tenable, slack, jira)" oninput="filterDocs(this.value)">
</div>
<div id="docsContent" class="mb-60"></div>
</div>
<div class="bar">
  <div class="st" id="saveStatus">Paste your keys above, then click Save.</div>
  <div class="bar-btns">
    <button class="btn btn-te" onclick="testAllConnections()">üîç Test All</button>
    <button class="btn-save" onclick="saveAll()">üíæ Save & Apply</button>
    <button class="btn-restart" id="btnRestart" onclick="restartServices()">üîÑ Restart to Apply</button>
  </div>
</div>
<script>
const API=window.location.origin+'/api/v1';
const config={};
const QUICK_FIELDS=[
  {cat:"Vulnerability Scanners",fields:[
    {key:"TENABLE_ACCESS_KEY",label:"Tenable Access Key",hint:"60-day lab ‚Üí tenable.com"},
    {key:"TENABLE_SECRET_KEY",label:"Tenable Secret Key",pw:true},
    {key:"QUALYS_USERNAME",label:"Qualys Username",hint:"30-day lab ‚Üí qualys.com"},
    {key:"QUALYS_PASSWORD",label:"Qualys Password",pw:true},
    {key:"RAPID7_API_KEY",label:"Rapid7 API Key",hint:"30-day lab ‚Üí rapid7.com",pw:true},
  ]},
  {cat:"Ticket Systems",fields:[
    {key:"SERVICENOW_INSTANCE",label:"ServiceNow Instance URL",hint:"Open dev instance ‚Üí developer.servicenow.com"},
    {key:"SERVICENOW_USERNAME",label:"ServiceNow Username"},
    {key:"SERVICENOW_PASSWORD",label:"ServiceNow Password",pw:true},
    {key:"JIRA_URL",label:"Jira URL",hint:"Open for 10 users ‚Üí atlassian.com/software/jira/free"},
    {key:"JIRA_EMAIL",label:"Jira Email"},
    {key:"JIRA_API_TOKEN",label:"Jira API Token",pw:true},
    {key:"JIRA_PROJECT_KEY",label:"Jira Project Key",hint:"Default: SEC"},
  ]},
  {cat:"Threat Intel (Optional - EPSS & KEV work without keys)",fields:[
    {key:"ABUSECH_AUTH_KEY",label:"abuse.ch Auth Key",hint:"Free signup ‚Üí auth.abuse.ch (required since June 2025)"},
    {key:"NVD_API_KEY",label:"NVD API Key",hint:"Optional. Higher rate limit. Open ‚Üí nvd.nist.gov/developers"},
    {key:"OTX_API_KEY",label:"AlienVault OTX API Key",hint:"Open ‚Üí otx.alienvault.com"},
    {key:"GREYNOISE_API_KEY",label:"GreyNoise API Key",hint:"Open community ‚Üí greynoise.io"},
  ]},
  {cat:"AI Providers",fields:[
    {key:"ANTHROPIC_API_KEY",label:"Anthropic Claude API Key",hint:"$5 free credits ‚Üí console.anthropic.com",pw:true},
    {key:"OPENAI_API_KEY",label:"OpenAI GPT API Key",hint:"$5 free credits ‚Üí platform.openai.com",pw:true},
  ]},
  {cat:"Notifications (pick one)",fields:[
    {key:"SLACK_WEBHOOK_URL",label:"Slack Webhook URL",hint:"Open ‚Üí api.slack.com/messaging/webhooks"},
    {key:"TEAMS_WEBHOOK_URL",label:"Teams Webhook URL",hint:"Channel ‚Üí Connectors ‚Üí Incoming Webhook"},
    {key:"SMTP_HOST",label:"SMTP Host",hint:"e.g. smtp.gmail.com"},
    {key:"SMTP_USER",label:"SMTP User"},
    {key:"SMTP_PASSWORD",label:"SMTP Password",pw:true},
    {key:"PAGERDUTY_ROUTING_KEY",label:"PagerDuty Routing Key",pw:true,hint:"14-day lab ‚Üí pagerduty.com"},
    {key:"WEBHOOK_URL",label:"Generic Webhook URL",hint:"Any URL - SIEM, SOAR, Zapier, n8n"},
  ]},
  {cat:"Cloud Compliance (Prowler + Asset Inventory)",fields:[
    {key:"AWS_ACCESS_KEY_ID",label:"AWS Access Key ID",hint:"Or use IAM role (recommended)"},
    {key:"AWS_SECRET_ACCESS_KEY",label:"AWS Secret Access Key",pw:true},
    {key:"AWS_DEFAULT_REGION",label:"AWS Region",hint:"Default: us-east-1"},
    {key:"AWS_PROWLER_ROLE_ARN",label:"AWS Role ARN (cross-account)",hint:"Optional: arn:aws:iam::123456:role/ProwlerRole"},
    {key:"AZURE_TENANT_ID",label:"Azure Tenant ID",hint:"App Registration ‚Üí Overview"},
    {key:"AZURE_CLIENT_ID",label:"Azure Client ID"},
    {key:"AZURE_CLIENT_SECRET",label:"Azure Client Secret",pw:true},
    {key:"AZURE_SUBSCRIPTION_ID",label:"Azure Subscription ID"},
    {key:"GCP_PROJECT_ID",label:"GCP Project ID"},
  ]},
];
const INTEGRATIONS=[
  {cat:"ZERO-CONFIG - Works Immediately (7 integrations)",items:[
    {id:"epss",name:"EPSS",file:"threatintel/api_provider.py",cost:"free",costL:"Open API",desc:"Exploitation probability. No auth needed.",auto:true},
    {id:"kev",name:"CISA KEV",file:"threatintel/api_provider.py",cost:"free",costL:"Open API",desc:"Known Exploited Vulnerabilities. Auto-downloaded.",auto:true},
    {id:"nvd",name:"NVD/NIST",file:"threatintel/nvd_client.py",cost:"free",costL:"Open API",desc:"Official CVE data from NIST.",auto:true},
    {id:"abusech",name:"abuse.ch",file:"threatintel/api_provider.py",cost:"free",costL:"Open",desc:"Malware/botnet indicators. Free Auth-Key required since June 2025.",signup:"https://auth.abuse.ch/",signupT:"Get Free Key ‚Üí",fields:[{key:"ABUSECH_AUTH_KEY",label:"Auth Key",pw:true}]},
    {id:"cmdb_csv",name:"CSV CMDB",file:"cmdb/provider.py",cost:"free",costL:"Built-in",desc:"15 demo assets. Edit CSV to add yours.",auto:true},
    {id:"console",name:"Console Tickets",file:"tickets/console.py",cost:"free",costL:"Built-in",desc:"Prints to stdout.",auto:true},
    {id:"local_intel",name:"Local EPSS+KEV",file:"threatintel/local_provider.py",cost:"free",costL:"Built-in",desc:"Offline files for air-gapped.",auto:true},
    {id:"ollama",name:"Ollama AI",file:"llm/ollama_provider.py",cost:"oss",costL:"Open Source",desc:"Local AI. In Docker Compose.",auto:true},
  ]},
  {cat:"OPEN SOURCE SCANNERS",items:[
    {id:"openvas",name:"OpenVAS",file:"scanners/openvas.py",cost:"oss",costL:"Open Source",desc:"Network vuln scanner.",docker:"docker run -d -p 9392:9392 greenbone/community-edition:stable",
     fields:[{key:"OPENVAS_HOST",label:"Host",def:"openvas"},{key:"OPENVAS_PORT",label:"Port",def:"9390"},{key:"OPENVAS_USER",label:"User",def:"admin"},{key:"OPENVAS_PASSWORD",label:"Pass",def:"admin",pw:true}]},
    {id:"wazuh",name:"Wazuh",file:"scanners/wazuh.py",cost:"oss",costL:"Open Source",desc:"Real-time endpoint detection.",docker:"docker run -d -p 55000:55000 wazuh/wazuh-manager:4.9.2",
     fields:[{key:"WAZUH_API_URL",label:"URL",def:"https://localhost:55000"},{key:"WAZUH_USERNAME",label:"User",def:"wazuh-wui"},{key:"WAZUH_PASSWORD",label:"Pass",def:"wazuh",pw:true}]},
    {id:"nessus_file",name:"Nessus File Import",file:"scanners/nessus_file.py",cost:"free",costL:"Built-in",desc:"Parse .nessus XML files. Works air-gapped.",auto:true},
  ]},
  {cat:"OPEN SANDBOXES",items:[
    {id:"servicenow",name:"ServiceNow",file:"tickets/servicenow.py",cost:"dev",costL:"Open Dev",desc:"Free PDI. Full API + CMDB.",signup:"https://developer.servicenow.com",signupT:"Get Free Instance ‚Üí",
     fields:[{key:"SERVICENOW_INSTANCE",label:"URL"},{key:"SERVICENOW_USERNAME",label:"User",def:"admin"},{key:"SERVICENOW_PASSWORD",label:"Pass",pw:true}]},
    {id:"jira",name:"Jira",file:"tickets/jira_provider.py",cost:"tier",costL:"Open Tier",desc:"Free 10 users.",signup:"https://www.atlassian.com/software/jira/free",signupT:"Create Account ‚Üí",
     fields:[{key:"JIRA_URL",label:"URL"},{key:"JIRA_EMAIL",label:"Email"},{key:"JIRA_API_TOKEN",label:"Token",pw:true},{key:"JIRA_PROJECT_KEY",label:"Project",def:"SEC"}]},
    {id:"otx",name:"AlienVault OTX",file:"threatintel/api_provider.py",cost:"tier",costL:"Open",desc:"Community threat intel.",signup:"https://otx.alienvault.com",signupT:"Get Key ‚Üí",fields:[{key:"OTX_API_KEY",label:"API Key",pw:true}]},
    {id:"greynoise",name:"GreyNoise",file:"threatintel/api_provider.py",cost:"tier",costL:"Open",desc:"Scanning detection.",signup:"https://www.greynoise.io/plans/community",signupT:"Get Key ‚Üí",fields:[{key:"GREYNOISE_API_KEY",label:"API Key",pw:true}]},
    {id:"cmdb_servicenow",name:"ServiceNow CMDB",file:"cmdb/provider.py",cost:"dev",costL:"Open Dev",desc:"Uses same ServiceNow PDI. CMDB tables pre-populated.",signup:"https://developer.servicenow.com",signupT:"Get Free Instance ‚Üí",
     fields:[{key:"SERVICENOW_INSTANCE",label:"URL",ht:"Same as ticket instance"},{key:"SERVICENOW_USERNAME",label:"User",def:"admin"},{key:"SERVICENOW_PASSWORD",label:"Pass",pw:true}]},
    {id:"nvd_key",name:"NVD API Key",file:"threatintel/nvd_client.py",cost:"free",costL:"Open",desc:"Optional. Increases rate limit from 5 to 50 req/30s.",signup:"https://nvd.nist.gov/developers/request-an-api-key",signupT:"Get Free Key ‚Üí",fields:[{key:"NVD_API_KEY",label:"API Key",pw:true}]},
  ]},
  {cat:"LAB ENVIRONMENTS",items:[
    {id:"tenable",name:"Tenable.io",file:"scanners/tenable.py",cost:"lab",costL:"60-day Lab",desc:"Enterprise scanner.",signup:"https://www.tenable.com/products/vulnerability-management/evaluate",signupT:"Start Lab ‚Üí",
     fields:[{key:"TENABLE_ACCESS_KEY",label:"Access Key",pw:true},{key:"TENABLE_SECRET_KEY",label:"Secret Key",pw:true}]},
    {id:"qualys",name:"Qualys",file:"scanners/qualys.py",cost:"lab",costL:"30-day Lab",desc:"Enterprise VMDR.",signup:"https://www.qualys.com/free-trial/",signupT:"Start Lab ‚Üí",
     fields:[{key:"QUALYS_API_URL",label:"API URL",def:"https://qualysapi.qualys.com"},{key:"QUALYS_USERNAME",label:"User"},{key:"QUALYS_PASSWORD",label:"Pass",pw:true}]},
    {id:"rapid7",name:"Rapid7",file:"scanners/rapid7.py",cost:"lab",costL:"30-day Lab",desc:"InsightVM.",signup:"https://www.rapid7.com/products/insightvm/free-trial/",signupT:"Start Lab ‚Üí",
     fields:[{key:"RAPID7_API_KEY",label:"API Key",pw:true},{key:"RAPID7_REGION",label:"Region",def:"us"}]},
    {id:"pagerduty",name:"PagerDuty",file:"tasks.py",cost:"lab",costL:"14-day Lab",desc:"Incident alerting.",signup:"https://www.pagerduty.com/sign-up-free/",signupT:"Start Lab ‚Üí",
     fields:[{key:"PAGERDUTY_ROUTING_KEY",label:"Routing Key",pw:true}]},
  ]},
  {cat:"NOTIFICATIONS",items:[
    {id:"slack",name:"Slack",file:"tasks.py",cost:"tier",costL:"Open",desc:"Webhook alerts.",signup:"https://api.slack.com/messaging/webhooks",signupT:"Create App ‚Üí",fields:[{key:"SLACK_WEBHOOK_URL",label:"Webhook URL"}]},
    {id:"teams",name:"Teams",file:"tasks.py",cost:"tier",costL:"Open",desc:"Webhook connector.",fields:[{key:"TEAMS_WEBHOOK_URL",label:"Webhook URL"}]},
    {id:"email",name:"Email",file:"tasks.py",cost:"tier",costL:"Open",desc:"SMTP alerts.",fields:[{key:"SMTP_HOST",label:"Host",def:"smtp.gmail.com"},{key:"SMTP_PORT",label:"Port",def:"587"},{key:"SMTP_USER",label:"User"},{key:"SMTP_PASSWORD",label:"Pass",pw:true},{key:"SMTP_FROM",label:"From"}]},
    {id:"webhook",name:"Webhook",file:"tasks.py",cost:"free",costL:"Built-in",desc:"JSON to any URL.",fields:[{key:"WEBHOOK_URL",label:"URL"},{key:"WEBHOOK_SECRET",label:"HMAC Secret",pw:true}]},
  ]},
  {cat:"AI CROSS-MODEL DEBATE",items:[
    {id:"anthropic",name:"Claude",file:"llm/anthropic_provider.py",cost:"tier",costL:"$5 Credits",desc:"Primary AI or Challenger.",signup:"https://console.anthropic.com",signupT:"Get Key ‚Üí",fields:[{key:"ANTHROPIC_API_KEY",label:"API Key",pw:true}]},
    {id:"openai",name:"GPT-4o",file:"llm/openai_provider.py",cost:"tier",costL:"$5 Credits",desc:"Cross-model Challenger.",signup:"https://platform.openai.com/api-keys",signupT:"Get Key ‚Üí",fields:[{key:"OPENAI_API_KEY",label:"API Key",pw:true}]},
  ]},
  {cat:"DARK WEB EXPLOIT INTELLIGENCE",items:[
    {id:"shodan_cvedb",name:"Shodan CVEDB",file:"threatintel/darkweb_provider.py",cost:"free",costL:"Open API",desc:"CVE enrichment with KEV, ransomware, EPSS. No auth needed.",auto:true},
    {id:"shodan_exploits",name:"Shodan Exploits",file:"threatintel/darkweb_provider.py",cost:"tier",costL:"Open Tier",desc:"Search weaponized exploits by CVE. Free API key on signup.",signup:"https://account.shodan.io/register",signupT:"Get Free Key ‚Üí",fields:[{key:"SHODAN_API_KEY",label:"API Key",pw:true}]},
    {id:"vuldb",name:"VulDB",file:"threatintel/darkweb_provider.py",cost:"tier",costL:"Open Tier",desc:"Exploit price forecasts + dark web risk scoring. Unique exploit market data.",signup:"https://vuldb.com/?register",signupT:"Get Free Key ‚Üí",fields:[{key:"VULDB_API_KEY",label:"API Key",pw:true}]},
    {id:"recorded_future",name:"Recorded Future",file:"threatintel/darkweb_provider.py",cost:"lab",costL:"30-day Lab",desc:"Dark web marketplace monitoring. Underground forum exploit tracking. Enterprise-grade.",signup:"https://www.recordedfuture.com/free-trial",signupT:"Start Lab ‚Üí",fields:[{key:"RECORDED_FUTURE_API_KEY",label:"API Token",pw:true}]},
    {id:"flashpoint",name:"Flashpoint",file:"threatintel/darkweb_provider.py",cost:"lab",costL:"Lab",desc:"Underground forum + marketplace exploit tracking.",signup:"https://flashpoint.io/demo/",signupT:"Request Demo ‚Üí",fields:[{key:"FLASHPOINT_API_KEY",label:"Bearer Token",pw:true}]},
  ]},
  {cat:"CLOUD COMPLIANCE (Prowler + Custodian)",items:[
    {id:"prowler_aws",name:"Prowler AWS",file:"cloud/prowler_runner.py",cost:"free",costL:"OSS",desc:"500+ checks, CIS/SOC2/HIPAA/PCI/NIST. Docker-ready.",signup:"https://docs.prowler.com/",signupT:"Docs ‚Üí",
     fields:[{key:"AWS_ACCESS_KEY_ID",label:"Access Key"},{key:"AWS_SECRET_ACCESS_KEY",label:"Secret Key",pw:true},{key:"AWS_DEFAULT_REGION",label:"Region",def:"us-east-1"}]},
    {id:"prowler_azure",name:"Prowler Azure",file:"cloud/prowler_runner.py",cost:"free",costL:"OSS",desc:"Azure CIS + SOC2 compliance scans.",
     fields:[{key:"AZURE_TENANT_ID",label:"Tenant ID"},{key:"AZURE_CLIENT_ID",label:"Client ID"},{key:"AZURE_CLIENT_SECRET",label:"Secret",pw:true},{key:"AZURE_SUBSCRIPTION_ID",label:"Subscription"}]},
    {id:"prowler_gcp",name:"Prowler GCP",file:"cloud/prowler_runner.py",cost:"free",costL:"OSS",desc:"GCP CIS + SOC2 compliance scans.",
     fields:[{key:"GCP_PROJECT_ID",label:"Project ID"}]},
    {id:"custodian",name:"Cloud Custodian",file:"cloud/custodian_runner.py",cost:"free",costL:"OSS",desc:"Custom YAML policies. 5 built-in.",signup:"https://cloudcustodian.io/docs/",signupT:"Docs ‚Üí",auto:true},
    {id:"intel471",name:"Intel 471",file:"threatintel/darkweb_provider.py",cost:"lab",costL:"Lab",desc:"Dark web broker monitoring. Exploit marketplace intel.",signup:"https://intel471.com/request-a-demo",signupT:"Request Demo ‚Üí",fields:[{key:"INTEL471_API_KEY",label:"API Key",pw:true}]},
  ]},
];

function showTab(t){document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.panel').forEach(e=>e.classList.remove('active'));document.getElementById('tab-'+t).classList.add('active');document.getElementById('panel-'+t).classList.add('active');if(t==='drift')loadDriftConfig();if(t==='docs')renderDocs()}

function renderQP(){
  const g=document.getElementById('qpGrid');g.innerHTML='';
  var icons = {'Vulnerability Scanners':'üîç','Ticket Systems':'üé´','Threat Intel':'üõ°Ô∏è','AI Providers':'ü§ñ','Notifications':'üîî','Dark Web Intelligence':'üïµÔ∏è'};
  QUICK_FIELDS.forEach(c=>{
    var section=document.createElement('div');section.className='qp-section';
    var catName=c.cat.split('(')[0].trim();
    var titleDiv=document.createElement('div');titleDiv.className='qp-section-title';
    titleDiv.innerHTML=(icons[catName]||'‚öôÔ∏è')+' '+c.cat;
    section.appendChild(titleDiv);
    var fieldsDiv=document.createElement('div');fieldsDiv.className='qp-fields';
    c.fields.forEach(f=>{
      const d=document.createElement('div');d.className='qp-field';
      d.innerHTML=`<label>${f.label}</label><input type="${f.pw?'password':'text'}" id="qp-${f.key}" data-key="${f.key}" placeholder="Paste here..." oninput="qpU(this)">${f.hint?`<div class="qp-hint">${f.hint}</div>`:''}`;
      fieldsDiv.appendChild(d);
    });
    section.appendChild(fieldsDiv);
    g.appendChild(section);
  });
}

function qpU(el){const k=el.dataset.key,v=el.value.trim();if(v){config[k]=v;el.classList.add('done')}else{delete config[k];el.classList.remove('done')}updCount()}
function updCount(){const n=Object.keys(config).length;document.getElementById('qpCount').textContent=n;document.getElementById('saveStatus').textContent=n?`${n} credential${n>1?'s':''} entered - click Save & Apply`:'Paste your keys above, then click Save.'}

function renderVis(){
  const el=document.getElementById('visualContent');el.innerHTML='';
  INTEGRATIONS.forEach(cat=>{
    let h=`<div class="cat"><div class="cat-title">${cat.cat}</div><div class="grid">`;
    cat.items.forEach(i=>{
      const bc={free:'b-free',lab:'b-lab',tier:'b-tier',oss:'b-oss',dev:'b-dev'}[i.cost]||'b-free';
      let fh='';if(i.fields){fh='<div class="ic-fields">'+i.fields.map(f=>`<div class="fd"><label>${f.label}</label><input type="${f.pw?'password':'text'}" value="${f.def||''}" data-key="${f.key}" oninput="vU('${f.key}',this.value,'${i.id}')">${f.ht?`<div class="ht">${f.ht}</div>`:''}</div>`).join('')+'</div>'}
      h+=`<div class="ic ${i.auto?'on':''}" id="card-${i.id}"><div class="ic-top"><div><div class="ic-name">${i.name}${i.auto?'<span class="auto-tag">AUTO</span>':''}</div><div class="ic-file">${i.file}</div></div><span class="badge ${bc}">${i.costL}</span></div><div class="ic-desc">${i.desc}</div><div class="ic-status"><div class="dot" id="dot-${i.id}"></div><span class="stxt" id="st-${i.id}">${i.auto?'‚úÖ Auto-enabled':'Not configured'}</span></div>${i.docker?`<div class="docker-cmd" onclick="navigator.clipboard.writeText(this.textContent);this.style.color='var(--green)'">${i.docker}</div>`:''}${fh}<div class="ic-btns">${i.fields?`<button class="btn btn-ex" onclick="document.getElementById('card-${i.id}').classList.toggle('expanded')">‚öôÔ∏è Configure</button>`:''}${i.signup?`<a href="${i.signup}" target="_blank" class="btn btn-su">${i.signupT}</a>`:''}<button class="btn btn-te" onclick="testOne('${i.id}')">Test</button></div></div>`;
    });
    h+='</div></div>';el.innerHTML+=h;
  });
}

function vU(k,v,id){if(v&&v!==''){config[k]=v;document.getElementById('card-'+id).classList.add('pending');document.getElementById('st-'+id).textContent='Configured - save to apply'}else{delete config[k]}updCount()}

async function testOne(id){
  const d=document.getElementById('dot-'+id),s=document.getElementById('st-'+id);
  d.style.background='var(--yellow)';s.textContent='Testing...';
  // Collect credentials from the card's input fields
  const creds={};
  document.querySelectorAll('#card-'+id+' [data-key]').forEach(el=>{const v=el.value.trim();if(v)creds[el.dataset.key]=v});
  try{const r=await fetch(`${API}/integrations/test/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(creds)});const j=await r.json();
    if(j.ok){d.style.background='var(--green)';s.textContent='‚úÖ '+(j.message||'Connected');document.getElementById('card-'+id).className='ic on expanded'}
    else{d.style.background='var(--red)';s.textContent='‚ùå '+(j.error||j.message||'Test failed')}
  }catch(e){d.style.background='var(--red)';s.textContent='‚ùå API offline'}
}

async function testAllConnections(){
  document.getElementById('saveStatus').textContent='Testing all...';let ok=0,fail=0;
  for(const c of INTEGRATIONS)for(const i of c.items){
    const creds={};
    document.querySelectorAll('#card-'+i.id+' [data-key]').forEach(el=>{const v=el.value.trim();if(v)creds[el.dataset.key]=v});
    try{const r=await fetch(`${API}/integrations/test/${i.id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(creds)});const j=await r.json();
      const d=document.getElementById('dot-'+i.id),s=document.getElementById('st-'+i.id);
      if(j.ok){d.style.background='var(--green)';s.textContent='‚úÖ '+j.message;ok++}
      else{d.style.background='var(--red)';s.textContent='‚ùå '+j.error;fail++}
    }catch(e){fail++}await new Promise(r=>setTimeout(r,150));
  }
  document.getElementById('saveStatus').textContent=`Done: ${ok} connected, ${fail} need config`;
}

async function saveAll(){
  document.querySelectorAll('[data-key]').forEach(el=>{const v=el.value.trim();if(v)config[el.dataset.key]=v});
  // Auto-detect providers
  if(config.TENABLE_ACCESS_KEY)config.SCANNER_PROVIDERS=[config.SCANNER_PROVIDERS,'tenable'].filter(Boolean).join(',');
  if(config.QUALYS_USERNAME)config.SCANNER_PROVIDERS=[config.SCANNER_PROVIDERS,'qualys'].filter(Boolean).join(',');
  if(config.RAPID7_API_KEY)config.SCANNER_PROVIDERS=[config.SCANNER_PROVIDERS,'rapid7'].filter(Boolean).join(',');
  if(config.AWS_ACCESS_KEY_ID||config.AZURE_TENANT_ID||config.GCP_PROJECT_ID)config.SCANNER_PROVIDERS=[config.SCANNER_PROVIDERS,'cloud'].filter(Boolean).join(',');
  if(!config.SCANNER_PROVIDERS)config.SCANNER_PROVIDERS='openvas';
  if(config.SERVICENOW_INSTANCE){config.TICKET_PROVIDER='servicenow';config.CMDB_PROVIDER='servicenow'}
  else if(config.JIRA_URL)config.TICKET_PROVIDER='jira';
  else config.TICKET_PROVIDER='console';
  if(config.ANTHROPIC_API_KEY)config.LLM_PROVIDER='anthropic';
  if(config.OPENAI_API_KEY&&!config.ANTHROPIC_API_KEY)config.LLM_PROVIDER='openai';
  if(config.OPENAI_API_KEY&&config.ANTHROPIC_API_KEY)config.CHALLENGER_PROVIDER='openai';
  if(config.SLACK_WEBHOOK_URL)config.NOTIFICATION_CHANNEL='slack';
  else if(config.TEAMS_WEBHOOK_URL)config.NOTIFICATION_CHANNEL='teams';
  else if(config.SMTP_HOST)config.NOTIFICATION_CHANNEL='email';
  else if(config.WEBHOOK_URL)config.NOTIFICATION_CHANNEL='webhook';
  config.THREATINTEL_MODE='api';

  document.getElementById('saveStatus').textContent='Saving...';
  try{
    const r=await fetch(`${API}/integrations/config`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});
    const d=await r.json();
    if(d.ok){document.getElementById('saveStatus').textContent='‚úÖ '+d.message;document.getElementById('btnRestart').style.display='inline-block'}
    else document.getElementById('saveStatus').textContent='‚ùå '+d.error;
  }catch(e){
    const t=Object.entries(config).map(([k,v])=>`${k}=${v}`).join('\n');
    const b=new Blob([t],{type:'text/plain'});const u=URL.createObjectURL(b);
    const a=document.createElement('a');a.href=u;a.download='.env';a.click();
    document.getElementById('saveStatus').textContent='üì• Downloaded .env - place in vulnpilot-ai/ and run: docker compose up -d';
  }
}

async function restartServices(){
  document.getElementById('saveStatus').textContent='Run: docker compose restart';
  document.getElementById('btnRestart').textContent='Run: docker compose restart';
}

renderQP();renderVis();loadDriftConfig();
// Auto-switch to tab based on URL hash
if(window.location.hash==='#drift'){showTab('drift')}
else if(window.location.hash==='#visual'){showTab('visual')}

// ‚ïê‚ïê‚ïê DRIFT DETECTOR CONFIG ‚ïê‚ïê‚ïê

async function loadDriftConfig(){
  try{
    const r=await fetch(API+'/drift/config');
    const d=await r.json();
    document.getElementById('driftT1').value=d.tier_1_hours||1;
    document.getElementById('driftT2').value=d.tier_2_hours||3;
    document.getElementById('driftT3').value=d.tier_3_hours||6;
    updateDriftDisplay();
  }catch(e){updateDriftDisplay()}
}

function applyDriftPreset(t1,t2,t3){
  document.getElementById('driftT1').value=t1;
  document.getElementById('driftT2').value=t2;
  document.getElementById('driftT3').value=t3;
  // Update active preset
  document.querySelectorAll('.drift-preset').forEach(b=>b.classList.remove('active'));
  event.currentTarget.classList.add('active');
  updateDriftDisplay();
}

function updateDriftDisplay(){
  const t1=parseInt(document.getElementById('driftT1').value);
  const t2=parseInt(document.getElementById('driftT2').value);
  const t3=parseInt(document.getElementById('driftT3').value);
  document.getElementById('driftT1Val').textContent=t1+'h';
  document.getElementById('driftT2Val').textContent=t2+'h';
  document.getElementById('driftT3Val').textContent=t3+'h';

  // Calculate impact
  const checksPerDay = Math.round(24/t1*13 + 24/t2*7 + 24/t3*27); // demo: 13 T1, 7 T2, 27 T3
  const maxExposure = t1;
  const costLevel = checksPerDay > 500 ? 'üî¥ High' : checksPerDay > 200 ? 'üü° Moderate' : 'üü¢ Low';

  document.getElementById('driftImpactText').innerHTML =
    `<strong>Crown jewels:</strong> rechecked every <strong>${t1}h</strong> (max ${t1}h exposure window)<br>` +
    `<strong>Important assets:</strong> rechecked every <strong>${t2}h</strong><br>` +
    `<strong>Standard assets:</strong> rechecked every <strong>${t3}h</strong><br>` +
    `<strong>Est. API calls/day:</strong> ~${checksPerDay} per 47 assets &nbsp;${costLevel} cost`;

  // Auto-detect preset match
  const presets = [[1,1,1,'realtime'],[1,2,4,'aggressive'],[1,3,6,'balanced'],[2,6,12,'conservative']];
  document.querySelectorAll('.drift-preset').forEach(b=>b.classList.remove('active'));
  for(const [p1,p2,p3,name] of presets){
    if(t1===p1&&t2===p2&&t3===p3){
      document.querySelector(`.drift-preset[data-name="${name}"]`)?.classList.add('active');
    }
  }
}

var _driftLocked = false;
var _driftDefaults = {t1: 1, t2: 3, t3: 6}; // Balanced preset

function resetDriftDefaults() {
  if (_driftLocked) return;
  document.getElementById('driftT1').value = _driftDefaults.t1;
  document.getElementById('driftT2').value = _driftDefaults.t2;
  document.getElementById('driftT3').value = _driftDefaults.t3;
  document.getElementById('driftV1').textContent = _driftDefaults.t1 + 'h';
  document.getElementById('driftV2').textContent = _driftDefaults.t2 + 'h';
  document.getElementById('driftV3').textContent = _driftDefaults.t3 + 'h';
  // Select Balanced preset
  document.querySelectorAll('.drift-preset').forEach(function(p){ p.classList.remove('active'); });
  document.querySelectorAll('.drift-preset')[2].classList.add('active');
  updateDriftPreview();
}

function toggleDriftLock() {
  _driftLocked = !_driftLocked;
  var btn = document.getElementById('driftLockBtn');
  var sliders = document.querySelectorAll('.drift-slider');
  var presets = document.querySelectorAll('.drift-preset');
  var saveBtn = document.getElementById('driftSaveBtn');
  if (_driftLocked) {
    btn.textContent = 'üîí LOCKED';
    btn.style.borderColor = '#ef4444';
    btn.style.color = '#ef4444';
    btn.style.background = '#fef2f2';
    btn.onmouseover = function(){ btn.style.background='#fecaca'; };
    btn.onmouseout = function(){ btn.style.background='#fef2f2'; };
    sliders.forEach(function(s){ s.disabled = true; s.style.opacity = '0.4'; });
    presets.forEach(function(p){ p.style.pointerEvents = 'none'; p.style.opacity = '0.5'; });
    saveBtn.disabled = true; saveBtn.style.opacity = '0.4';
  } else {
    btn.textContent = 'üîì UNLOCKED';
    btn.style.borderColor = '#f97316';
    btn.style.color = '#f97316';
    btn.style.background = '#fff7ed';
    btn.onmouseover = function(){ btn.style.background='#fed7aa'; };
    btn.onmouseout = function(){ btn.style.background='#fff7ed'; };
    sliders.forEach(function(s){ s.disabled = false; s.style.opacity = '1'; });
    presets.forEach(function(p){ p.style.pointerEvents = 'auto'; p.style.opacity = '1'; });
    saveBtn.disabled = false; saveBtn.style.opacity = '1';
  }
}

async function saveDriftConfig(){
  const t1=parseInt(document.getElementById('driftT1').value);
  const t2=parseInt(document.getElementById('driftT2').value);
  const t3=parseInt(document.getElementById('driftT3').value);
  const btn=document.getElementById('driftSaveBtn');
  const st=document.getElementById('driftSaveStatus');
  btn.textContent='Saving...';btn.disabled=true;
  try{
    const r=await fetch(API+'/drift/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tier_1_hours:t1,tier_2_hours:t2,tier_3_hours:t3})});
    const d=await r.json();
    if(d.status==='ok'){
      btn.textContent='‚úÖ Saved!';btn.style.background='linear-gradient(135deg,#16A34A,#15803D)';
      st.textContent=`Drift intervals: T1=${t1}h, T2=${t2}h, T3=${t3}h. Restart services to apply.`;
      st.style.color='#16A34A';
      setTimeout(()=>{btn.textContent='üíæ Save Drift Configuration';btn.style.background='';btn.disabled=false},3000);
    }else{
      btn.textContent='‚ùå Error';st.textContent=d.error||'Failed to save';st.style.color='#EF4444';
      setTimeout(()=>{btn.textContent='üíæ Save Drift Configuration';btn.disabled=false},2000);
    }
  }catch(e){
    btn.textContent='üíæ Save Drift Configuration';btn.disabled=false;
    st.textContent='‚ö†Ô∏è Server not reachable. Settings will apply when VulnPilot is running.';st.style.color='#FBBF24';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOCS TAB: 27 integrations, accordion, test
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DI=[
{cat:"Vulnerability Scanners",ico:"üîç",items:[
{name:"Tenable.io",badge:"COMMERCIAL",bc:"b-lab",sum:"Industry-leading VM. Exports API + pyTenable 1.9.0. CVEs at plugin.cve.",docs:"https://developer.tenable.com/docs/tenableio-integrations",tid:"tenable",
steps:[{t:"Create API Keys",d:'<strong>cloud.tenable.com</strong> ‚Üí Settings ‚Üí My Account ‚Üí API Keys ‚Üí Generate. Access Key + Secret Key (64-char hex).'},{t:"Set Env Vars",env:'TENABLE_ACCESS_KEY=<span class="v">your-64-char-access-key</span>\nTENABLE_SECRET_KEY=<span class="v">your-64-char-secret-key</span>'},{t:"How It Works",d:'Async Exports API (POST /vulns/export). ~500 assets/chunk. pyTenable handles pagination + retries. New: epss_score, vpr_v2, cvss4_base_score fields.'}],
spec:{Auth:"X-ApiKeys header",Rate:"Dynamic (429 + retry-after)",Pagination:"Async chunks",Library:"pyTenable 1.9.0+"},
warn:"pyTenable 1.9.0 migrated to Pydantic v2. Without time filters, only last 30 days returned."},
{name:"Qualys VMDR",badge:"COMMERCIAL",bc:"b-lab",sum:"Enterprise VM. Two-step QID‚ÜíCVE via KnowledgeBase API (FIXED ‚Äî was missing 40% of CVEs).",docs:"https://docs.qualys.com/en/vm/api/assets/host_lists/host_detection.htm",tid:"qualys",
steps:[{t:"Get Credentials",d:'Qualys Platform ‚Üí Administration ‚Üí API account. <strong>Find your platform URL</strong> (Help ‚Üí About): US1=qualysapi.qualys.com, US2=qualysapi.qg2.apps.qualys.com'},{t:"Set Env Vars",env:'QUALYS_USERNAME=<span class="v">your-username</span>\nQUALYS_PASSWORD=<span class="v">your-password</span>\nQUALYS_API_URL=<span class="v">https://qualysapi.qualys.com</span> <span class="c"># match YOUR platform</span>'},{t:"How It Works",d:'<strong>Two-step (FIXED):</strong> 1) Host detections ‚Üí QIDs. 2) Batch KB lookup (50/batch) ‚Üí CVEs from &lt;CVE_LIST&gt; XML. Auto-paginates via id_min.'}],
spec:{Auth:"Basic + X-Requested-With",Rate:"2-10 concurrent, 300-2000/hr",KB:"Batch QID‚ÜíCVE lookup",Response:"XML"},
warn:"v2.0 KB deprecated March 2025 (still works). Silent truncation at 1000 hosts ‚Äî now auto-paginated."},
{name:"Rapid7 InsightVM",badge:"COMMERCIAL",bc:"b-lab",sum:"Cloud-native VM. Updated to v4 API + cursor-based pagination (FIXED).",docs:"https://help.rapid7.com/insightvm/en-us/api/api.html",tid:"rapid7",
steps:[{t:"Generate API Key",d:'<strong>insight.rapid7.com</strong> ‚Üí Platform Admin ‚Üí API Keys ‚Üí New Org Key.'},{t:"Set Env Vars",env:'RAPID7_API_KEY=<span class="v">your-key</span>\nRAPID7_REGION=<span class="v">us</span> <span class="c"># us,us2,us3,eu,ca,au,ap</span>'},{t:"How It Works",d:'Cloud API v4 at /vm/v4/integration/assets. <strong>Cursor pagination (FIXED)</strong> ‚Äî no duplicates/gaps.'}],
spec:{Auth:"X-Api-Key header",Regions:"us, us2, us3, eu, ca, au, ap, me-central-1, ap-south-2",Pagination:"Cursor-based (v4)"},
warn:"v3 Console (Basic Auth, port 3780) and v4 Cloud (X-Api-Key) are NOT interchangeable."},
{name:"OpenVAS / Greenbone",badge:"FREE / OSS",bc:"b-oss",sum:"Open-source scanner. GMP protocol (XML over socket).",docs:"https://greenbone.github.io/docs/latest/",tid:"openvas",
steps:[{t:"Deploy",d:'Docker included in stack. Default: admin/admin. Change immediately.'},{t:"Set Env Vars",env:'OPENVAS_HOST=<span class="v">openvas</span>\nOPENVAS_PORT=<span class="v">9390</span>\nOPENVAS_USERNAME=<span class="v">admin</span>\nOPENVAS_PASSWORD=<span class="v">your-password</span>'}],
spec:{Protocol:"GMP 22.7",Library:"python-gvm v26.x"},warn:"Default 60s timeout too short. Use --timeout -1 for large scans."},
{name:"Wazuh SIEM",badge:"FREE / OSS",bc:"b-oss",sum:"Agent-based SIEM. JWT auth, port 55000. Vuln data in indexer (not REST API).",docs:"https://documentation.wazuh.com/current/user-manual/api/getting-started.html",tid:"wazuh",
steps:[{t:"Deploy",d:'Manager API on port 55000 (HTTPS). Default: wazuh-wui / wazuh.'},{t:"Set Env Vars",env:'WAZUH_API_URL=<span class="v">https://wazuh-manager:55000</span>\nWAZUH_USERNAME=<span class="v">wazuh-wui</span>\nWAZUH_PASSWORD=<span class="v">wazuh</span>'}],
spec:{Auth:"JWT (15min tokens)",Data:"Wazuh indexer port 9200"},warn:"Legacy /vulnerability/{id} deprecated since 4.8. Changing token expiry revokes ALL tokens."},
{name:"Nessus File Import",badge:"FREE",bc:"b-free",sum:"Import .nessus XML files directly. No API key needed.",tid:"nessus_file",
steps:[{t:"Export",d:'Nessus ‚Üí Scans ‚Üí Export ‚Üí .nessus format.'},{t:"Upload",d:'Place in <code>data/nessus/</code>. Auto-ingested.'}],
spec:{Format:".nessus XML",Auth:"None"}}
]},
{cat:"Threat Intelligence",ico:"üõ°Ô∏è",items:[
{name:"EPSS (FIRST.org)",badge:"FREE",bc:"b-free",sum:"Exploit probability score (0-1). Feeds VPRS Threat Intel weight (25%).",docs:"https://www.first.org/epss/api",tid:"epss",
steps:[{t:"No Setup Required",d:'Free public API. Auto-called for every CVE.'}],spec:{Auth:"None",Endpoint:"api.first.org/data/v1/epss",Auto:"‚úÖ Always enabled"}},
{name:"CISA KEV Catalog",badge:"FREE",bc:"b-free",sum:"Known Exploited Vulns. Triggers Lock 1 hard rules.",docs:"https://www.cisa.gov/known-exploited-vulnerabilities-catalog",tid:"kev",
steps:[{t:"No Setup Required",d:'Free JSON feed. Auto-cached.'}],spec:{Auto:"‚úÖ Always enabled ‚Äî triggers Lock 1"}},
{name:"NVD (NIST)",badge:"FREE",bc:"b-free",sum:"Authoritative CVSS, CWE, CPE data.",docs:"https://nvd.nist.gov/developers/vulnerabilities",tid:"nvd",
steps:[{t:"Optional API Key",d:'Free at nvd.nist.gov/developers. 5‚Üí50 req/30sec.'},{t:"Set Var (Optional)",env:'NVD_API_KEY=<span class="v">your-key</span>'}],spec:{Rate:"5/30sec ‚Üí 50/30sec with key"}},
{name:"abuse.ch",badge:"FREE (key req'd)",bc:"b-free",sum:"ThreatFox + URLhaus. IOCs linked to CVEs.",docs:"https://threatfox.abuse.ch/api/",tid:"abusech",
steps:[{t:"Get Auth Key",d:'Free at <strong>auth.abuse.ch</strong> (required since June 2025).'},{t:"Set Var",env:'ABUSECH_AUTH_KEY=<span class="v">your-key</span>'}],spec:{Auth:"Auth-Key header"}},
{name:"AlienVault OTX",badge:"FREE",bc:"b-free",sum:"Community threat intel pulses.",docs:"https://otx.alienvault.com/api",tid:"otx",
steps:[{t:"Get Key",d:'<strong>otx.alienvault.com</strong> ‚Üí Settings ‚Üí API Key.'},{t:"Set Var",env:'OTX_API_KEY=<span class="v">your-key</span>'}],spec:{Rate:"10,000/hr"}},
{name:"GreyNoise",badge:"FREE TIER",bc:"b-free",sum:"Internet scan data. Mass-exploitation vs targeted.",docs:"https://docs.greynoise.io/",tid:"greynoise",
steps:[{t:"Get Key",d:'<strong>greynoise.io</strong> ‚Üí API Key. Free: 50/day.'},{t:"Set Var",env:'GREYNOISE_API_KEY=<span class="v">your-key</span>'}],spec:{Rate:"50/day (community)"}},
{name:"MITRE ATT&CK",badge:"BUILT-IN",bc:"b-free",sum:"CVE‚Üítechnique mapping. Bundled.",tid:"local_intel",
steps:[{t:"No Setup",d:'Bundled with VulnPilot. Updated on rebuild.'}],spec:{Auto:"‚úÖ Always enabled"}},
{name:"Dark Web Monitor",badge:"EXPERIMENTAL",bc:"b-dev",sum:"OSINT dark web exploit mentions.",
steps:[{t:"Auto",d:'OSINT aggregation. Experimental, limited coverage.'}],spec:{Status:"Experimental"}}
]},
{cat:"Ticketing & Workflow",ico:"üé´",items:[
{name:"Jira Cloud",badge:"COMMERCIAL",bc:"b-lab",sum:"Auto-create tickets with VPRS score, debate transcript, remediation.",docs:"https://developer.atlassian.com/cloud/jira/platform/rest/v3/",tid:"jira",
steps:[{t:"Create Token",d:'<strong>id.atlassian.com/manage-profile/security/api-tokens</strong>'},{t:"Set Vars",env:'JIRA_URL=<span class="v">https://company.atlassian.net</span>\nJIRA_EMAIL=<span class="v">you@company.com</span>\nJIRA_API_TOKEN=<span class="v">your-token</span>\nJIRA_PROJECT_KEY=<span class="v">SEC</span>'}],spec:{Auth:"Basic (email+token)",API:"REST v3"}},
{name:"ServiceNow",badge:"COMMERCIAL",bc:"b-lab",sum:"Enterprise ITSM with VPRS context and SLA routing.",docs:"https://developer.servicenow.com/",tid:"servicenow",
steps:[{t:"Get Dev Instance",d:'Free at <strong>developer.servicenow.com</strong>'},{t:"Set Vars",env:'SERVICENOW_INSTANCE=<span class="v">https://dev12345.service-now.com</span>\nSERVICENOW_USERNAME=<span class="v">admin</span>\nSERVICENOW_PASSWORD=<span class="v">your-pass</span>'}],spec:{Auth:"Basic Auth",Lab:"Free dev instance"}},
{name:"PagerDuty",badge:"COMMERCIAL",bc:"b-lab",sum:"Auto-pages for VPRS Critical (90+) only.",docs:"https://developer.pagerduty.com/",tid:"pagerduty",
steps:[{t:"Create Key",d:'Services ‚Üí Integrations ‚Üí Events API v2 ‚Üí Routing Key.'},{t:"Set Var",env:'PAGERDUTY_ROUTING_KEY=<span class="v">your-key</span>'}],spec:{Triggers:"VPRS 90+ only"}}
]},
{cat:"Notifications",ico:"üîî",items:[
{name:"Slack Webhook",badge:"FREE",bc:"b-free",sum:"Real-time alerts with VPRS badges.",docs:"https://api.slack.com/messaging/webhooks",tid:"slack",
steps:[{t:"Create Webhook",d:'api.slack.com/apps ‚Üí Incoming Webhooks ‚Üí select channel.'},{t:"Set Var",env:'SLACK_WEBHOOK_URL=<span class="v">https://hooks.slack.com/services/T.../B.../xxx</span>'}],spec:{Auth:"Webhook URL"}},
{name:"Microsoft Teams",badge:"FREE",bc:"b-free",sum:"Alerts via incoming webhook.",docs:"https://learn.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/",tid:"teams",
steps:[{t:"Create Webhook",d:'Teams ‚Üí channel ‚Üí ‚Ä¢‚Ä¢‚Ä¢ ‚Üí Connectors ‚Üí Incoming Webhook.'},{t:"Set Var",env:'TEAMS_WEBHOOK_URL=<span class="v">https://outlook.office.com/webhook/...</span>'}],spec:{Format:"Adaptive Cards"}},
{name:"Email (SMTP)",badge:"FREE",bc:"b-free",sum:"Any SMTP provider. Gmail, SES, SendGrid.",tid:"email",
steps:[{t:"Set Vars",env:'SMTP_HOST=<span class="v">smtp.gmail.com</span>\nSMTP_PORT=<span class="v">587</span>\nSMTP_USER=<span class="v">you@gmail.com</span>\nSMTP_PASSWORD=<span class="v">app-password</span>'}],spec:{TLS:"STARTTLS (587)"}}
]},
{cat:"AI Providers",ico:"ü§ñ",items:[
{name:"Ollama (Local)",badge:"FREE / LOCAL",bc:"b-oss",sum:"Run LLMs locally. Zero cost. Air-gapped. Default provider.",docs:"https://ollama.ai/",tid:"ollama",
steps:[{t:"Install",d:'<code>curl -fsSL https://ollama.ai/install.sh | sh</code> or Docker (included).'},{t:"Pull Model",d:'<code>ollama pull llama3.1:8b</code> (4GB) or <code>ollama pull llama3.1:70b</code> (48GB+).'},{t:"Set Vars",env:'OLLAMA_BASE_URL=<span class="v">http://ollama:11434</span>\nOLLAMA_MODEL=<span class="v">llama3.1:8b</span>'}],spec:{Port:"11434",Auto:"‚úÖ Default provider"}},
{name:"Claude API",badge:"COMMERCIAL",bc:"b-tier",sum:"Best for adversarial debate (Lock 2).",docs:"https://docs.anthropic.com/",tid:"anthropic",
steps:[{t:"Get Key",d:'<strong>console.anthropic.com</strong> ‚Üí API Keys.'},{t:"Set Var",env:'ANTHROPIC_API_KEY=<span class="v">sk-ant-...</span>'}],spec:{Model:"claude-sonnet-4-20250514"}},
{name:"OpenAI GPT-4o",badge:"COMMERCIAL",bc:"b-tier",sum:"Fast cloud AI alternative.",docs:"https://platform.openai.com/docs",tid:"openai",
steps:[{t:"Get Key",d:'<strong>platform.openai.com</strong> ‚Üí API Keys.'},{t:"Set Var",env:'OPENAI_API_KEY=<span class="v">sk-...</span>'}],spec:{Model:"gpt-4o"}}
]},
{cat:"Asset Management",ico:"üìã",items:[
{name:"CMDB / CSV Import",badge:"BUILT-IN",bc:"b-free",sum:"Asset tier, owner, BU context for VPRS scoring.",tid:"cmdb_csv",
steps:[{t:"Prepare CSV",d:'Columns: <code>ip_address, hostname, asset_tier, owner, business_unit, is_internet_facing</code>'},{t:"Upload",d:'Place in <code>data/cmdb/</code>. Auto-ingested.'}],spec:{Auto:"‚úÖ Built-in"}}
]},
{cat:"Cloud Compliance",ico:"‚òÅÔ∏è",items:[
{name:"Prowler (AWS/Azure/GCP)",badge:"FREE / OSS",bc:"b-oss",sum:"500+ checks, 39 compliance frameworks. Runs in Docker. OCSF output auto-parsed.",docs:"https://docs.prowler.com/",tid:"cloud",
steps:[{t:"Enable Cloud Profile",d:'Run: <code>docker compose --profile cloud up -d</code> to start Prowler container.'},{t:"Set AWS Credentials",env:'AWS_ACCESS_KEY_ID=<span class="v">AKIA...</span>\nAWS_SECRET_ACCESS_KEY=<span class="v">your-secret</span>\nAWS_DEFAULT_REGION=<span class="v">us-east-1</span>\nAWS_PROWLER_ROLE_ARN=<span class="v">arn:aws:iam::123456:role/ProwlerRole</span> <span class="c"># optional cross-acct</span>'},{t:"Or Use Demo Mode",d:'Set <code>CLOUD_DEMO_MODE=true</code> (default). Uses sample Prowler output for demos ‚Äî no live cloud needed.'},{t:"How It Works",d:'VulnPilot triggers Prowler ‚Üí OCSF JSON output ‚Üí auto-parsed ‚Üí compliance findings appear in dashboard alongside vulnerability data. Set <code>SCANNER_PROVIDERS=tenable,cloud</code> to run both.'}],
spec:{Checks:"500+",Frameworks:"CIS, SOC2, HIPAA, PCI, NIST, GDPR, ISO27001, FedRAMP, MITRE ATT&CK",Output:"OCSF v1.1 JSON",Docker:"toniblyx/prowler:latest"},
warn:"First AWS scan takes 20-40 min for full account. Use --severity critical,high for faster scans."},
{name:"Cloud Custodian",badge:"FREE / OSS",bc:"b-oss",sum:"Custom YAML policy engine. Define org-specific rules beyond Prowler.",docs:"https://cloudcustodian.io/docs/",
steps:[{t:"Install",d:'<code>pip install c7n</code> (already in Docker image).'},{t:"Add Policies",d:'Drop .yml files in <code>config/custodian/</code>. VulnPilot auto-discovers them. 5 built-in policies included.'},{t:"How It Works",d:'Prowler = standard framework checks. Custodian = YOUR custom rules (e.g. "flag EC2 > 90 days unpatched", "S3 without versioning in prod"). Results merge into same dashboard.'}],
spec:{Engine:"YAML policies",Clouds:"AWS, Azure, GCP",Builtin:"5 security baseline policies"}},
{name:"AWS Asset Inventory",badge:"FREE",bc:"b-free",sum:"boto3 direct API calls for EC2, RDS, S3, Lambda, ELB inventory. Feeds VPRS asset tier scoring.",docs:"https://boto3.amazonaws.com/v1/documentation/api/latest/",
steps:[{t:"Same Credentials",d:'Uses same AWS credentials as Prowler. No extra setup.'},{t:"How It Works",d:'Collects EC2 instances, RDS databases, S3 buckets, Lambda functions, ELBs. Derives asset tier from cloud tags (Environment=production ‚Üí tier_1). Feeds VPRS Asset Criticality weight (20%).'}],
spec:{Services:"EC2, RDS, S3, Lambda, ELB",Tier_Derivation:"Tags ‚Üí asset_tier",Internet_Facing:"Auto-detected"}},
{name:"Azure / GCP Collectors",badge:"PLANNED",bc:"b-dev",sum:"Azure SDK + GCP Cloud Asset API for multi-cloud inventory. Ready for credential integration.",docs:"#",
steps:[{t:"Azure",d:'Set: <code>AZURE_TENANT_ID</code>, <code>AZURE_CLIENT_ID</code>, <code>AZURE_CLIENT_SECRET</code>, <code>AZURE_SUBSCRIPTION_ID</code>. Requires: azure-identity, azure-mgmt-compute.'},{t:"GCP",d:'Set: <code>GCP_PROJECT_ID</code>, <code>GOOGLE_APPLICATION_CREDENTIALS</code>. Requires: google-cloud-asset.'}],
spec:{Status:"Stubs ready, SDKs commented in requirements.txt"}}
]}
];

function renderDocs(){
  const el=document.getElementById('docsContent');if(!el)return;let h='';
  DI.forEach(cat=>{
    h+=`<div class="docs-cat" data-cat="${cat.cat}"><div class="docs-cat-hdr"><span style="font-size:20px">${cat.ico}</span><div><div class="docs-cat-title">${cat.cat}</div><div class="docs-cat-count">${cat.items.length} integration${cat.items.length>1?'s':''}</div></div></div>`;
    cat.items.forEach(it=>{
      const auto=['epss','kev','mitre','cmdb_csv','nessus_file','local_intel'].includes(it.tid||'');
      h+=`<div class="acc ${auto?'connected':''}" data-search="${(it.name+' '+it.sum+' '+cat.cat).toLowerCase()}">`;
      h+=`<div class="acc-hdr" onclick="this.parentElement.classList.toggle('open')"><div class="acc-info"><div class="acc-name">${it.name}</div><div class="acc-sub">${it.sum}</div></div><div class="acc-badges"><span class="badge ${it.bc||'b-free'}">${it.badge||'FREE'}</span></div><div class="acc-arrow">‚ñº</div></div>`;
      h+=`<div class="acc-body">`;
      if(it.steps)it.steps.forEach((s,i)=>{h+=`<div class="step"><div class="step-n">${i+1}</div><div class="step-c"><strong>${s.t}</strong><br>${s.d||''}${s.env?`<div class="doc-env" onclick="navigator.clipboard.writeText(this.innerText);this.style.borderColor='var(--green)';setTimeout(()=>this.style.borderColor='',1500)">${s.env}</div>`:''}</div></div>`});
      if(it.spec){h+=`<div class="doc-spec"><div class="doc-spec-title">‚öôÔ∏è API Spec</div>`;Object.entries(it.spec).forEach(([k,v])=>{h+=`<div class="doc-spec-row"><span class="doc-spec-k">${k}</span><span class="doc-spec-v">${v}</span></div>`});h+=`</div>`}
      if(it.warn)h+=`<div class="doc-warn"><strong>‚ö†Ô∏è</strong> ${it.warn}</div>`;
      if(auto)h+=`<div class="doc-ok"><strong>‚úÖ Auto-enabled</strong> ‚Äî works out of the box.</div>`;
      h+=`<div style="display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap">`;
      if(it.tid)h+=`<button class="doc-test-btn" onclick="docTest('${it.tid}',this)">üîå Test Connection</button>`;
      if(it.docs&&it.docs!=='#')h+=`<a href="${it.docs}" target="_blank" style="font-size:11px;color:var(--blue-light)">üìÑ Official Docs ‚Üí</a>`;
      h+=`</div>`;if(it.tid)h+=`<div id="dtr-${it.tid}" style="margin-top:6px;font-size:11px;font-family:'JetBrains Mono',monospace;min-height:16px"></div>`;
      h+=`</div></div>`;
    });h+=`</div>`;
  });el.innerHTML=h;
}

async function docTest(id,btn){
  const r=document.getElementById('dtr-'+id);if(!r)return;
  btn.textContent='‚è≥ Testing...';btn.disabled=true;r.textContent='';
  try{
    const resp=await fetch(API+'/integrations/'+id+'/test',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({})});
    const d=await resp.json();
    if(d.ok){r.innerHTML='<span style="color:var(--green)">‚úÖ '+(d.message||'Connected')+'</span>';btn.textContent='‚úÖ Connected';btn.style.borderColor='var(--green)';btn.style.color='var(--green)'}
    else{r.innerHTML='<span style="color:var(--red)">‚ùå '+(d.error||'Failed')+'</span>';btn.textContent='‚ùå Failed';btn.style.color='var(--red)'}
  }catch(e){r.innerHTML='<span style="color:var(--dim)">‚ö†Ô∏è Server offline ‚Äî run: docker-compose up -d</span>';btn.textContent='‚ö†Ô∏è Offline'}
  btn.disabled=false;setTimeout(()=>{btn.textContent='üîå Test Connection';btn.style.borderColor='';btn.style.color=''},5000);
}
function filterDocs(q){q=q.toLowerCase().trim();document.querySelectorAll('.acc').forEach(a=>{a.style.display=(!q||(a.dataset.search||'').includes(q))?'':'none'});document.querySelectorAll('.docs-cat').forEach(c=>{c.style.display=c.querySelector('.acc:not([style*="none"])')?'':'none'})}
function expandAllDocs(){document.querySelectorAll('.acc').forEach(a=>a.classList.add('open'))}
function collapseAllDocs(){document.querySelectorAll('.acc').forEach(a=>a.classList.remove('open'))}

// Deep-link: auto-open docs tab from hash
(function(){var h=window.location.hash.replace('#','');if(h&&document.getElementById('tab-'+h))showTab(h)})();
</script>
</body>
</html>
